:root{
  --bg:#0a1a2a; /* Blue theme */
  --panel:rgba(10,26,42,0.55);
  --glass-border: rgba(255,255,255,0.08);
  --ink:#e6fff4;
  --muted:#96c4b0;
  --border:#0b2a22;
  --accent:#ef4444;
  --accent-600:#dc2626;
--accent-50:#991b1b;
  --ring: 0 0 0 3px rgba(239,68,68,0.25);
}

/* Biomes */
[data-biome="Forest"]{ 
  --bg:#0a1a2a; 
  --accent:#ef4444; 
  --accent-red:#dc2626; 
  --accent-light:#f87171;
  --accent-dark:#b91c1c;
  --red-light:#fca5a5;
  --red-dark:#991b1b;
  --red-tape:#dc2626;
}

*{box-sizing:border-box}
html,body,#root{height:100%}
body{
  margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;
  background:var(--bg); color:var(--ink);
  -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
}
::selection{ background: rgba(239,68,68,.22); }

/* Scrollbars */
*::-webkit-scrollbar{ width:10px; height:10px }
*::-webkit-scrollbar-thumb{ background: rgba(255,255,255,0.1); border-radius:999px; border: 2px solid transparent; background-clip: padding-box; }
*{ scrollbar-color: rgba(255,255,255,0.1) transparent; scrollbar-width: thin; }

/* Spotlights */
body::before{
  content:""; position:fixed; inset:0; pointer-events:none; z-index:-1;
  background:
    radial-gradient(1200px 600px at -10% -10%, rgba(30,58,138,0.45), transparent 60%),
    radial-gradient(800px 500px at 110% 0%, rgba(59,130,246,0.35), transparent 60%),
    radial-gradient(1000px 600px at 50% 120%, rgba(239,68,68,0.30), transparent 60%);
}

.container{max-width:1120px;margin:0 auto;padding:24px}
.app{ display:grid; gap:20px; grid-template-columns: 1fr; }
.glass{
  background: var(--panel);
  border:1px solid var(--glass-border);
  border-radius:18px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.25), inset 0 1px rgba(255,255,255,0.35);
  backdrop-filter: blur(12px) saturate(130%);
  position:relative;
  transition: border-color .2s ease, background .2s ease, transform .2s ease, box-shadow .2s ease;
}
.glass::before{ /* glossy edge */
  content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none;
  background: linear-gradient(180deg, rgba(255,255,255,0.15), transparent 40%);
}
.card{ background: transparent; border: none; border-radius: 18px; }

/* Sidebar */
.sidebar{padding:12px; display:flex; flex-direction:column; gap:12px;}
.sidebar header{display:flex; align-items:center; gap:10px; padding:8px 8px 4px 8px}
.brand{
  width:28px; height:28px; border-radius:10px;
  background: conic-gradient(from 180deg at 50% 50%, #ef4444, #f87171, #dc2626, #ef4444);
}
.h1{font-size:18px; margin:0}
.new-btn{
  display:flex; align-items:center; justify-content:center; gap:8px;
  padding:10px 12px; border:1px dashed var(--glass-border); border-radius:12px; background:rgba(239,68,68,0.08);
}
.new-btn:hover{filter:brightness(0.98)}
.thread-list{display:flex; flex-direction:column; gap:8px; margin-top:8px;}
.thread{
  padding:10px 12px; border:1px solid var(--glass-border); border-radius:12px; background:rgba(255,255,255,0.03); cursor:pointer;
  display:flex; gap:8px; align-items:center; justify-content:space-between;
}
.thread.active{outline: var(--ring)}
.thread .name{overflow:hidden; text-overflow:ellipsis; white-space:nowrap;}
.thread .actions{display:flex; gap:6px}
.icon-btn{
  background:rgba(255,255,255,0.06); border:1px solid var(--glass-border); border-radius:10px; padding:6px 8px; cursor:pointer; color:var(--ink);
}
.icon-btn:hover{filter:brightness(0.98)}

/* Chat area */
/* Header layout fixes */
.header{display:flex; align-items:center; justify-content:space-between; padding:16px 20px; gap:16px; flex-wrap:wrap}
.header-tools{display:flex; align-items:center; gap:16px; flex-wrap:wrap; margin-left:12px}

/* Ensure container keeps consistent inner spacing for main section */
.main > .composer{ padding:16px 20px; }
.messages{ padding:12px 20px; }
.export-row{ padding:0 20px 16px; }

.tag{font-size:12px; padding:4px 8px; border:1px solid var(--border); border-radius:999px; color:var(--muted)}
/* Constrain readable width in messages */
.messages{padding:12px 20px; display:flex; flex-direction:column; gap:12px; max-height:60vh; overflow:auto;}
.messages .bubble{ max-width: 900px; width: 100%; word-wrap: break-word; overflow-wrap: anywhere; }
.messages .bubble *{ min-width: 0; }
.messages .bubble p, .messages .bubble li { word-wrap: break-word; overflow-wrap: anywhere; }
.messages .bubble a{ word-break: break-all; }
.messages .bubble img{ max-width: 100%; height:auto; display:block }
.messages .bubble pre{ max-width: 100%; overflow:auto; white-space: pre-wrap; word-break: break-word; }
.messages .bubble code{ white-space: pre-wrap; word-break: break-word; }
.messages .bubble table{ display:block; max-width:100%; overflow:auto; border-collapse: collapse; }
.msg{ display:flex; gap:10px; align-items:flex-start; }
.bubble{ background:rgba(255,255,255,0.06); border:1px solid var(--glass-border); border-radius:16px; padding:10px 12px; max-width:80%; position:relative; }
.msg.assistant .bubble{ background: rgba(239,68,68,0.06); }
.avatar{ width:28px; height:28px; border-radius:50%; background:var(--accent); color:white; display:flex; align-items:center; justify-content:center; font-weight:700; box-shadow:0 0 0 2px #fff; }
.meta{font-size:12px;color:var(--muted); margin-bottom:4px}

/* Streaming shimmer + dew dots */
.bubble.streaming::after{ display:none }
@keyframes shimmer{}
.dots{ display:none }
@keyframes dew{}

/* Markdown */
.bubble h1,.bubble h2,.bubble h3{margin:8px 0 4px}
.bubble pre{background:#991b1b; color:#fecaca; padding:10px; border-radius:10px; overflow:auto}
.bubble code{background:#991b1b; padding:2px 4px; border-radius:6px}

/* Links */
a{ color: var(--accent); text-decoration: none; }
a:hover{ text-decoration: underline; }

/* Attachments */
.attachments{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
.attachments.masonry{ column-count: auto; column-gap: 10px; }
.attachments.masonry img{ width: 100%; max-width: 360px; break-inside: avoid; margin-bottom: 10px; }
.attachment{ border:1px solid var(--glass-border); border-radius:10px; padding:8px; background:rgba(255,255,255,0.06); font-size:12px; color:var(--ink); transition: transform .2s ease, box-shadow .2s ease; display:inline-flex; align-items:center; gap:6px; }
.attachment:hover{ transform: translateY(-1px) scale(1.02) rotate(0.2deg); box-shadow: 0 10px 18px rgba(0,0,0,0.2); }
.attachments img{ transition: transform .25s ease, filter .25s ease; cursor: zoom-in; }
.attachments img:hover{ transform: scale(1.025); filter: saturate(1.05); }

/* Composer */
.composer{padding:12px 16px; display:flex; flex-direction:column; gap:10px;}
textarea{ width:100%; min-height:100px; padding:12px; border:1px solid var(--glass-border); border-radius:12px; resize:vertical; background:rgba(255,255,255,0.06); color:var(--ink); caret-color: var(--accent);}
.btn-row{display:flex; gap:8px; justify-content:space-between; align-items:center}
.action-center{ display:flex; justify-content:center; align-items:center; padding:8px 0; }
.ellipsis{ display:inline-flex; gap:4px; font-weight:700; color: var(--muted); }
.ellipsis span{ animation: blink 1.2s infinite; }
.ellipsis span:nth-child(2){ animation-delay: .2s }
.ellipsis span:nth-child(3){ animation-delay: .4s }
@keyframes blink{ 0%, 20%{ opacity: 0.2 } 50%{ opacity: 1 } 100%{ opacity: 0.2 } }
.btn{ position:relative; overflow:hidden; border:1px solid var(--glass-border); background:rgba(255,255,255,0.06); color:var(--ink); border-radius:12px; padding:10px 16px; cursor:pointer; transition: transform .06s ease, background .2s ease; }
.btn:hover{ transform: translateY(-1px) scale(1.01); box-shadow: 0 6px 12px rgba(0,0,0,0.18); }
.btn:active{ transform: scale(.98); }
.btn.primary{ 
  background: rgba(239,68,68,0.15);
  border: 1px solid rgba(239,68,68,0.5);
  color: #ffffff;
  border-radius: 12px;
  padding: 10px 16px;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
  overflow: hidden;
}

.btn.primary::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, #ef4444, #dc2626, #b91c1c);
  opacity: 0;
  transition: opacity 0.2s ease;
}

.btn.primary::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(239,68,68,0.05), rgba(220,38,38,0.05));
  opacity: 0;
  transition: opacity 0.2s ease;
}

.btn.primary:hover{ 
  transform: translateY(-1px) scale(1.01);
  box-shadow: 0 6px 12px rgba(239,68,68,0.15);
  border-color: rgba(239,68,68,0.7);
  background: rgba(239,68,68,0.2);
}

.btn.primary:hover::before {
  opacity: 1;
}

.btn.primary:hover::after {
  opacity: 1;
}

.btn.primary:active {
  transform: scale(.98);
}
.btn.primary:disabled{ opacity:.7; cursor:not-allowed }
.btn::after{ content:""; position:absolute; inset:-60% -20%; background:linear-gradient(120deg, transparent, rgba(255,255,255,0.35), transparent); transform: translateX(-120%); }
.btn:hover::after{ animation: sheen 1s ease forwards; }
@keyframes sheen { to { transform: translateX(120%); } }

/* Click ripple effect */
.btn::before{ content:""; position:absolute; width:10px; height:10px; border-radius:999px; pointer-events:none; background: rgba(255,255,255,0.5); transform: scale(0); opacity:0; }
.btn:active::before{ animation: ripple .45s ease-out; }
@keyframes ripple{ 0%{ transform: translate(var(--x,0), var(--y,0)) scale(0); opacity:.6 } 80%{ opacity:.2 } 100%{ transform: translate(var(--x,0), var(--y,0)) scale(16); opacity:0 } }

/* Skeleton loading blocks */
.skeleton{ display:grid; gap:8px; }
.skeleton-line{ height:12px; border-radius:999px; background: linear-gradient(90deg, rgba(255,255,255,0.04), rgba(255,255,255,0.12), rgba(255,255,255,0.04)); background-size: 200% 100%; animation: skeleton-move 1.2s ease-in-out infinite; }
.skeleton-line.w-80{ width:80% }
.skeleton-line.w-90{ width:90% }
.skeleton-line.w-70{ width:70% }
.skeleton-line.w-60{ width:60% }
@keyframes skeleton-move{ 0%{ background-position: 200% 0 } 100%{ background-position: -200% 0 } }

/* Select + file input */
select.btn{ appearance:none; padding-right:28px; background-image: linear-gradient(transparent,transparent), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="%23e6fff4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>'); background-repeat:no-repeat; background-position:right 10px center; }
input[type="file"]{ color:var(--muted); }

/* Focus rings */
:focus-visible{ outline: var(--ring); }

/* Reduced motion */
@media (prefers-reduced-motion: reduce){ .bubble.streaming::after, .dots i{ animation: none; } }

/* Responsive */
@media (max-width: 900px){ .app{ grid-template-columns: 1fr; } .messages{ max-height: 55vh; } }

/* Print styles (Export PDF) */
@media print {
  @page { margin: 16mm; }
  body{ background: white !important; color: black !important; }
  .app{ grid-template-columns: 1fr; }
  /* Hide non-response UI */
  .header, .composer, .export-row, .header-tools, .particles, .ripples, .btn, select, input, textarea, label { display: none !important; }
  /* Show messages only, fully expanded */
  .messages{ max-height: none !important; overflow: visible !important; padding: 0 !important; }
  .messages .bubble{ box-shadow: none !important; border:1px solid #e5e7eb !important; background: #fff !important; }
  /* Remove glass effects for legibility */
  .glass{ box-shadow: none !important; border:1px solid #e5e7eb !important; backdrop-filter: none !important; background: #fff !important; }
  /* Notice banner */
  .notice{ display:block !important; margin: 0 0 8px 0 !important; border-color:#cfcfcf !important; color:black !important; background:#fff !important; }
}

/* Brand area */
.brand-wrap{ display:flex; align-items:flex-start; gap:14px; }
/* Brand area uses favicon as logo */
.brand-logo{ width:40px; height:40px; border-radius:12px; background: var(--panel); border:1px solid var(--border); position:relative; overflow:hidden }
.brand-logo::before{ content:""; position:absolute; inset:0; background: conic-gradient(from 180deg at 50% 50%, #ef4444, #f87171, #dc2626, #ef4444); -webkit-mask: url('/favicon.svg') center / contain no-repeat; mask: url('/favicon.svg') center / contain no-repeat; }

.brand-text{ display:flex; flex-direction:column; }
.brand-text .title{ font-weight:800; font-size:22px; letter-spacing:.2px; line-height: 1.2; margin-bottom: 2px; }
.brand-text .subtitle{ margin-top: 0; color: var(--muted); }

/* Notice banner (jurisdiction) */
.notice{ margin: 0 20px 8px; border:1px solid var(--border); color: var(--muted); background: var(--panel); border-radius: 999px; padding: 6px 10px; width: fit-content; }

/* Composer actions spacing */
.btn-row > div:last-child{ display:flex; gap:10px; }

/* Space between panels */
.composer{ margin-bottom: 10px; }
.messages{ margin-top: 6px; }
.between-indicator{ display:flex; justify-content:center; align-items:center; padding:6px 0; }

/* Response panel title */
.panel-title{ font-size: 13px; font-weight: 600; color: var(--muted); padding: 6px 0 10px; border-bottom: 1px solid var(--border); margin-bottom: 8px; position: static; }

/* Liquid glass polish */
.glass{ background: color-mix(in srgb, var(--panel) 86%, transparent); border:1px solid var(--border); border-radius:16px; backdrop-filter: blur(10px) saturate(1.2); box-shadow: 0 6px 24px rgba(0,0,0,0.06), inset 0 1px rgba(255,255,255,0.4); }
.btn{ position:relative; overflow:hidden }
.btn::after{ content:""; position:absolute; inset:-1px; background: linear-gradient(120deg, rgba(255,255,255,0.25), transparent 40%); transform: translateX(-120%); transition: transform .6s ease; }
.btn:hover::after{ transform: translateX(0); }

/* Print header for PDF */
.print-header{ display:none; }
@media print {
  @page { margin: 14mm; }
  .print-header{ display:block; margin-bottom: 10mm; }
  .print-brand{ display:flex; align-items:center; gap:10px; }
  .print-logo-img{ width:28px; height:28px; border-radius:6px; display:block }
  .print-text{ display:flex; flex-direction:column; }
  .print-title{ font-weight:800; font-size:18px; }
  .print-sub{ color:#374151; font-size:12px; }
  .print-meta{ margin-top:4px; color:#374151; font-size:12px; }
}

/* Toasts */
.toast{
  position: fixed; bottom: 16px; right: 16px; z-index: 50;
  background: var(--panel); color: var(--ink); border:1px solid var(--glass-border);
  border-radius: 12px; padding: 10px 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.25);
  backdrop-filter: blur(10px) saturate(130%);
}

/* Lightbox */
.lightbox{ position: fixed; inset: 0; background: rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; z-index: 60; }
.lightbox img{ max-width: 92vw; max-height: 92vh; border-radius: 12px; border:1px solid var(--glass-border); box-shadow: 0 20px 60px rgba(0,0,0,0.5); }

/* Markdown polish */
.messages .bubble h1,.messages .bubble h2,.messages .bubble h3{ margin:10px 0 6px; }
.messages .bubble blockquote{ border-left:3px solid var(--border); margin:8px 0; padding:6px 10px; background: color-mix(in srgb, #fecaca 18%, transparent); border-radius: 12px; }
.messages .bubble pre{ background:#991b1b; color:#fecaca; padding:12px; border-radius:12px; }
.messages .bubble code{ background:rgba(239,68,68,0.08); padding:2px 4px; border-radius:6px; }

/* Keep composer and messages spacing tight but consistent */
.composer{ margin-bottom: 12px; }
.messages{ margin-top: 6px; }

/* Buttons group spacing */
.btn-row > div:last-child{ display:flex; gap:12px; }

/* Report layout */
.report{ display:flex; flex-direction:column; gap:14px; }
.report-head{ display:flex; align-items:center; gap:8px; }
.summary-banner{
  border:1px solid var(--glass-border);
  background: color-mix(in srgb, var(--panel) 88%, transparent);
  border-radius:12px; padding:10px 12px;
}
.summary-banner .summary-title{ font-weight:600; font-size:13px; color:var(--muted); margin-bottom:4px; }

.report-toc{ border:1px dashed var(--glass-border); border-radius:12px; padding:10px 12px; }
.report-toc .toc-title{ font-weight:600; font-size:13px; color:var(--muted); margin-bottom:6px; }
.report-toc ul{ margin:0; padding-left:16px; display:grid; gap:4px; }
.report-toc li{ list-style: none; border-radius:8px; padding:2px 6px; transition: background .2s ease, transform .2s ease; animation: fade-in .5s ease both; }
.report-toc li.active{ background: rgba(255,255,255,0.06); }
.report-toc li::before{ content:"• "; color: var(--muted); margin-right:4px; }
.report-toc li.lvl-1{ margin-left:0 }
.report-toc li.lvl-2{ margin-left:8px }
.report-toc li.lvl-3{ margin-left:16px }

@keyframes fade-in {
  from { opacity: 0; transform: translateY(6px); }
  to { opacity: 1; transform: translateY(0); }
}

.report-body{ line-height:1.6; }
.report-body h1,.report-body h2,.report-body h3{ scroll-margin-top: 90px; }
.report-attachments .section-label,
.references .section-label{ font-size:13px; font-weight:600; color:var(--muted); margin-bottom:6px; }

.references ul{ margin:0; padding-left:16px; display:grid; gap:6px; }
.references .ref-url{ color: var(--muted); margin-left:6px; font-size:12px; }

/* Streaming indicator line already handled; ensure fit with report */
.report.streaming::after{ display:none }

/* Footer */
.site-footer{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 20px; margin-top:8px;
  border-top:1px solid var(--border); color: var(--muted); font-size:12px; }
.footer-left{ display:flex; align-items:center; gap:8px; }
.footer-logo{ width:16px; height:16px; border-radius:4px; display:block }
.footer-brand{ font-weight:600; color: var(--ink); font-size:13px; }

/* Print-only container hidden on screen */
.print-only{ display:none; }

/* Override/append print rules to ensure print-only content appears */
@media print {
  /* Hide interactive/screen-only UI including live messages list */
  .header, .composer, .export-row, .header-tools, .particles, .ripples, .btn, select, input, textarea, label, .messages { display: none !important; }
  /* Show print-only block */
  .print-only{ display:block !important; }
}

